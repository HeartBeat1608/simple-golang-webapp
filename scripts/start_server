#!/bin/sh

BIN_PATH=/home/ec2-user/swebapp/swebapp
LOG_PATH=/home/ec2-user/swebapp/swebapp.log

rm -f $LOG_PATH

function BuildApp {
    cd /home/ec2-user/swebapp
    echo "Building Application" >> $LOG_PATH
    go mod tidy >> $LOG_PATH
    go build -o swebapp . >> $LOG_PATH
}

function runApp {
    echo "Running scripts" >> $LOG_PATH
    pm2 stop swebapp >> $LOG_PATH
    pm2 start --name swebapp $BIN_PATH >> $LOG_PATH
    pm2 save >> $LOG_PATH
}

BuildApp
runApp